# 介绍

通常来说,一个区块链是一个不可变的交易账本，被维护在一个对等节点的分布式网络中。这些节点通过一致的协议来验证"交易"维护着一份分账,被分组到包含一个hash的块中，该hash将每个块绑定到前面的块。

第一个并且最出名的一个区块链应用是Bitcoin(比特币)，还有其他类似。Ethereum(以太坊币)，另外一种加密货币。采用了一种不同的方法，集成了许多与比特币相同的特性，但加入了智能契约，为分布式应用创建了一个平台。Bitcoin和Ethereum属于区块链类，我们将其归类为没有公开许可的区块链技术。根本上来说，他们都是一个公开的网络，对任何人开放，并且对参与者互动进行匿名。

随着Bitcoin，Ethereum和一些其他的衍生技术的发展，将区块链的底层技术、分布式账簿和分布式应用平台应用于更具创新性的企业用例的兴趣也随之发展。然而,许多企业用例需要性能特征，而无许可的区块链技术(目前)无法交付这些特性。此外，在许多用例中，参与者的身份是一个硬性要求，例如在金融交易中，必须遵守“认识你的客户”(KYC)和反洗钱(AML)规定。（性能问题,必须遵守一个共同的交易协议）

对于企业应用,需要考虑一下需求:

- 参与者必须识别的。
- 网络必须被许可。
- 高事物(transaction)吞吐量
- 低延迟的事物确认
- 与业务事务有关的事务和数据的隐私和机密性

虽然许多早期的区块链平台目前正在为企业使用而进行调整，但从一开始Hyperledger Fabric就为企业的使用设计的。下面章节说明Hyperledger Fabric怎样不同于其他区块链平台和描述一些它的设计决策的动机。

## Hyperledger Fabric

Hyperledger Fabric 是一个开源的企业级分布式账本技术(DLT)平台，设计用于在企业环境中使用，它提供了一些关键的区分能力，而不是其他流行的分布式帐本或区块链平台。

一个关键不同点是Hyperledger在Linux基金会下建立的，基金会本身有一段很长很成功的历史，在开放治理下培育开放源码项目，培育强大的可持续社区和繁荣的生态系统。社区如何如何强大.....


Fabric有一个高度模块化和可配置化的架构，能够为广泛的行业用例(包括银行、金融、保险、医疗、人力资源、供应链甚至数字音乐交付)提供创新、多功能性和优化。

Fabric是第一个支持使用通用编程语言(如Java、Go和Node)编写的智能契约的分布式账本平台。更容易使用。

Fabric平台网络是公开的，参与者是互信的。

最重要的一个不同之一是它支持插件化的共识协议，这允许平台可以更加有效的来定制化适合特定的用例和信任模型。例如，当在单个企业中部署或由受信任的权威操作时，完全复杂的容错共识可能被认为是不必要的，并且会对性能和吞吐量造成过度的拖累。在这种情况下，崩溃容错(CFT)共识协议可能已经足够了。然而，在多种类、分散的用例中，可能需要一种更传统的拜占庭容错(BFT)共识协议。

Fabric可以利用一些共识协议(不需要本地加密货币)来提高开采成本或促进智能的合同执行。避免使用加密货币可以减少一些重要的风险/攻击向量，而不使用加密挖掘操作意味着平台的部署成本可以与任何其他分布式系统大致相同。

这些不同的功能设计让Fabric成为当今在事务处理和事务确认延迟方面性能更好的平台之一，并且它支持事务的隐私性和保密性，以及实现它们的智能契约(Fabric称之为“chaincode”)。

让我们更深入看看这些不同的功能特性。

## 模块化

Hyperledger Fabric已经特别实现了一些模块化的功能。无论是可插入的一致性、可插入的身份管理协议(如LDAP或OpenID连接、密钥管理协议或加密库)，平台都是在其核心设计的，以满足企业用例需求的多样性。

在一个高等级下,Fabric包含以下的模块化组件:

- 一个插件式的订单服务建立在相同的事物顺序和广播每个块到每个对等点的共识上。
- 一个插件式的会员服务提供者的职责是使用密码身份联系各个网络中的实体。
- 一个参数化的点对点gossip服务通过向其他对等点订购服务来散播数据块。
- 智能合约("chaincode")运行在一个隔离的容器环境中(例如Docker)。它们可以用标准编程语言编写，但不能直接访问总账状态。
- 账本可以配置来支持各种各样的DBMS。
- 插入式的签注和验证策略实施，每个应用程序都可以独立配置。

## Permissioned vs Permissionless Blockchains

在一个私有链中，事实上每个人可以加入，并且每个人都是匿名的。在这种情况下，除了区块链本身某种程度上的状态之外，没有其他可靠的东西。为了减轻这种不信任感，私有链通常使用“挖掘”的本地加密货币或交易费用，以提供经济激励，以抵消以“工作证明”(PoW)为基础的拜占庭式容错共识形式参与的特殊成本。

公有链，在另一方面，在一组已知的、识别的、通常经过审查的参与者中操作区块链，这些参与者在一个产生一定程度信任的治理模型下操作。一个公有链提供一种方式来确保有共同目标但可能彼此不完全信任的一组实体之间进行交互。通过依赖参与者的身份，一个公有链可以使用更传统的崩溃容错(CFT)或拜占庭容错(BFT)协商一致协议，不需要昂贵的挖矿。

另外，在这种公开的情况下，参与者通过智能合约带来的恶意代码的风险被降低了。首先，参与者知道另外一个人的所有动作，是否提交支持这次交易，修改网络的配置或者发布一个智能合约是有记录在区块链的（通过为网络和相关事务类型发布一个证书策略）。而不是完全的匿名，犯罪的人可以被容易的标识并且这个时间可以按照处理模型策略进行处理。

## Smart Contracts 智能合约

一个smart contract,或者说是一个"chaincode",作为一个分布式应用程序它从区块链中在每个对等点的底层共识中拥有信任(大家底层有一个协议，认为"chaincode"是OK的)。

支持smart contract有三个关键点，特别当要支持一个平台的时候:

- 网络中并发运行着很多的智能合约。
- 它们可能是动态发布的（任何人多种方式），并且
- 应用的代码可能会被检查为不可靠的，甚至是恶意的。

很多已经存在的智能合约支持区块链平台遵循协商一致协议的order-execute体系结构，其中的一致的协议:

- 验证并订购事务，然后将其传播到所有对等节点。
- 每个对等点顺序执行事务（并发然后由order service统一排序）。

order-execute的架构事实上可以在所有已存在的区块链系统中找到，从公共/非授权平台(如Ethereum(PoW-based的一致性)到Tendermint、Chain和Quorum)等授权平台。

可以肯定的是智能合约执行在order-execute架构的区块链中；否则，永远不可能达成共识。为了解决不确定的事情，许多平台需要智能合约可以写入非标准的或者领域特定语言（比如Solidity）这样就可以消除不确定性运算。

## 一种新的方式

Fabric介绍了一种新事务的架构为```execute-order-validate```.它通过将事务流分为三个步骤来解决order-execute模型所面临的弹性、灵活性、可伸缩性、性能和机密性方面的挑战:

- 执行一个交易并检验正确性，从而来认可这次交易。
- 排序交易通过一个插件化的共识协议，并且
- 在提交到账本之前根据特定于应用程序的背书策略验证交易。

这种设计从根本上背离了Fabric中的order-execute范式，即在对其订单达成最终协议之前执行事务。

在Fabric,一个特定于应用程序的背书策略(endorsement policy)特别指定对等点，或者其中的多个，来保证正确执行给定的智能合约。因此，每个事务只需要由满足事务背书策略所需的对等节点的子集执行(背书)。就是每个事物只需要由这次验证的背书策略的对等点来确定，而不是整个系统来确定。这种方式允许并发执行从而提高系统整体性能和伸缩性。第一阶段还消除了任何不确定性，因为在排序之前可以过滤掉不一致的结果。

因为我们消除了不确定性，Fabric是第一个能够使用标准的编程语言的区块链技术。在1.1.0版本,只能合约可以通过Go或Node.js编写，并且还决定支持常用语言包括Java.

## Privacy and Confidentiality(安全方面-隐私和保密)

我们已经讨论过，私有链网络平衡PoW来组成共识模型，交易执行在每个节点中。这个意味着合约本身或者他们处理的交易数据也不能保密。每个交易，还有实现的代码，它在网络中对每个节点公开。这种方式，用机密来换取共识。

这种安全性的损失可能是很多用户/企业使用的一个问题。例如，在一个供应链合作伙伴网络中，一些消费者为了巩固关系来提供一些利益，或者增加额外的销售。如果每个伙伴都可以看到合约和交易，在一个完全透明的网络中，要维持这样的业务关系是不可能的，因为每个人都想要更好的利润。

第二个例子，在一些秘密产业中，一个商人建立和出售的情况不想给她的竞争者所知道，或者让他们参与进来进行交易干扰。

为了解决这种安全性的缺失在启用应用中的需求。区块链平台采用了多种方法。都有自己权衡。

加密数据是一种提供安全性的方式；然而，私有网络利用PoW实现共识，加密的数据存在在每个节点中。如果有足够的时间和计算资源，这个加密的数据可能会被破解。对于很多个企业使用来说，这种危及它们的信息的妥协是不能被接受。

零知识证明(ZKP)是解决这一问题的另一个研究领域。目前计算一个ZKP需要大量的时间和计算资源。因此，采取ZKP需要权衡下性能消耗。

在公开的情况下，可以利用其他形式的共识，可以试试将机密信息仅仅分发给授权的节点的方式。

Hyperledger Fabric,作为一个公有的平台，通过channel的架构来实现保密性。基础上，在Fabric网络中的参与者可以在这些为特定事务集授予可见性的参与者的子集建立一个"channel"。可以把它看作一个网络覆盖(overlay)。因此，只有这些节点加入一个channel来使用智能合约(chaincode)和数据交易，从而来保护安全性。

为了提高隐私和保密能力，Fabric在未来添加工作于零知识证明(ZKP)识别的私有数据的支持。更多关于这一点，因为它变得可用。

## 可插入式共识

事务的顺序委托给一个模块化组件，以实现共识，在逻辑上与执行事务和维护分类帐的对等节点分离。这个组件是ordering service。自从共识变成模块化，它的实现可以对特定部署或解决方案的正确假设进行调整。这个模块化的架构允许平台依赖完善的CFT(崩溃容错)或BFT(拜占庭容错)排序工具箱。

在当前的可用版本中，Fabric提供一个CFTordering service由Kafka和Zookeeper实现。在随后的版本中，Fabric将会实现一个  Raft consensus ordering service 由etcd/Raft和一个完全分散化的BFT ordering service。

要注意他们并不互相排斥。一个Fabric网络可以有多个ordering service支持不同的应用或者应用需求。

## 性能和伸缩性

一个区块链的平台性能可以被多个因素影响例如交易大小，区块的大小，网络带宽，硬盘的限制等等。Hyperledger社区目前开发 a draft set of measures(一套解决方式)来解决性能和扩展性的平衡，以及一个称为Hyperledger Caliper的基准框架的相应实现。

尽管这项工作还在继续进行中，应该被视为区块链平台性能和规模特征的最终衡量标准，但IBM Research的一个团队发表了一篇同行评议的论文，评估了Hyperledger Fabric的体系结构和性能。文章对Fabric的体系结构进行了深入讨论，然后报告了团队使用Hyperledger Fabric v1.1的初步发布对平台的性能评估。

研究团队做的基准测试让Fabric v1.1.0的性能提升到v1.0.0的两倍。

## 结论

任何对区块链的严肃的评估都必须包括Hyperledger fabric结构。

Fabric的差异化功能使其成为一个高度可扩展的系统，用于支持灵活的信任假设，使平台能够支持从政府、金融、供应链物流到医疗保健等广泛的行业用例。

更重要的是，Hyperledger Fabric是十个Hyperledger项目中最活跃的。。。。。。。