#Hyperledger Fabric 模型

这个章节主要简述了Hyperledger Fabric履行其全面的、可定制的企业区块链解决方案的承诺的关键设计功能:

- Assets —— 资产是指可以通过网络使用货币来交易几乎所有的东西，从全食超市到古董车到货币期货。
- Chaincode —— chaincode执行是由交易顺序划分的，限制需求的信任等级和验证通过的节点类型，并有最佳的网络伸缩性和性能。
- Ledger Features —— 不可变的，共享的ledger对每个通道的整个交易历史进行编码，并包含类似sql的查询功能，用于有效的审计和纠纷解决。
- Privacy —— 通道和隐私数据集合云溪私有的和独立的多方向的事物来通常允许有竞争性的企业和在公共网络上交换资产的受监管行业。
- Security & Membership Service —— 共有的身份验证提供一个可信的区块链网络，网络中的参与者可以知道所有的交易都可以被授权监管机构和审计机关追踪。
- Consensus —— 一个唯一的方式达成共识支持企业所需的灵活性和可伸缩性。

## Assets

Assets可以包括真实的（资产或者硬件）到虚拟的（合同和知识产权）。Hyperledger Fabric提供一个能力使用chaincode transaction来重定义资产.

Assets在Hyperledger Fabric代表为一个key-value对的集合,并且状态改变记录为交易存放在一个Channel ledger。Asset可以用为二进制或者JSON表示。

可以在Hyperledger Fabric使用Hyperledger Composer tool应用来特制和使用资产。

## Chaincode

chaincode是定义一个资产(asset)或者多个资产的软件，以及修改资产的交易指令；换句话说，chaincode就是业务逻辑。chaincode强制执行读取或者修改键值对或者其它状态数据库信息的规则。chaincode方法执行针对ledger当前状态数据库并且通过一个交易提案发起。Chaincode执行结果在一个键值对的写（写集合），它可以提交到网络并被所有的对等点的ledger所接受。

## Ledger 功能

Ledger在fabric中是指有顺序的,不可篡改的所有状态转换的记录。状态转换是chaincode通过参加调用(‘transaction’)提交的一个结果。每次交易结果生产一个资产键值堆的集合，作为创建，更新或者删除提交到ledger中。

ledger由一个区块链组成用来存储链中的不可变的，有序结果记录并且用于维护当前fabric状态的状态数据库。一个ledger一个channel。每个peer为其所属的每个通道维护一份分类帐副本。

Fabric ledger的功能:

- 使用查询和更新基于键的查找、范围查询和组合键查询。
- 只读查询支持大量查询语言(如果使用CouchDB作为状态数据库)。
- 只读历史查询——通过一个key来查询ledger历史，用于数据出处场景。
- 交易由chaincode中的读写集合键值对的所有版本组成。
- 交易包括每个背书对等点的签名并且被提交到ordering service。
- 交易在区块中被排序并且在通道中被从ordering service运输到对等点。
- 对等点根据背书策略和强制策略来验证交易。
- 一旦一个交易被验证并且被提交那么不可变。
- 一个通道ledger包括一个配置区块来定义策略、访问控制列表和其他相关信息。
- 通道包括Membership Service Provider实例允许来自不同证书颁发机构的加密材料。

有关数据库、存储结构和“查询能力”的深入研究，请参阅Ledger主题。

## Privacy

Hyperledger Fabric 在每个通道的基础上使用一个不可变的ledger，以及可以操作和修改资产当前状态(即更新键值对)的chaincode。一个ledger存在在channel域中——它可以通过整个网络共享(假设每个参与者都在一个公共通道上操作)——它可以私有化，只包括特定的参与者。

在后者的情况下，这些参与者会创建一个独立的channel从而隔离他们的交易和ledger。为了解决想要在完全透明和隐私之间架起桥梁的场景，chaincode可以仅被安装在需要读写访问资产状态的对等点中(换句话说,如果一个chaincode不是安装在一个peer中，它将不能正确地与分类帐接口)。

当一个channel中的子组织需要机密的保持它们的交易数据，一个私有的数据集合(collection)会使用在一个隔离开的私有数据库中，在逻辑上从channel ledger中隔离，只接受已验证的子组织的访问。

因此，channel在广域网络中保持着交易的隐秘性而集合在channel中的子组织中保持数据的隐秘性。

为了进一步的混淆数据，在发送交易到ordering service和拼接区块到ledger中之前chaincode里的值可以使用常见的加密算法，如AES进行加密(部分或整个).一旦加密数据被写入ledger，只有拥有用于生成密码文本的对应密钥的用户才能解密。

## Security & Membership Services

Hyperledger Fabric支持一个所有参与者都知道身份的交易网络。公钥基础设施用于生成与组织、网络组件和最终用户或客户端应用程序相关联的加密证书。因此，数据访问控制可以在更广泛的网络和通道级别上进行操作和管理。这种"公开的"Hyperledger  Fabric主旨，再加上渠道的存在和功能，有助于解决隐私和保密至上的问题。

## 共识

在分布式账本技术中，共识最近成为一个特定算法的同义词，在一个单一的函数中。然而，共识不仅仅简单的包含一个交易的顺序，这种区分在Hyperledger Fabric上通过它在整个事务流中的基本角色而突出，从提议和背书，到订购，验证和承诺。简单的说，共识是指对包含块的一组事务的正确性进行完整的验证。

当一个块的事务的顺序和结果满足明确的策略标准检查时，它就达成共识。这些检查和平衡发送在一个交易的生命周期，并且包括使用背书策略来规定哪些特定成员必须背书某个事务类，以及系统链码以确保这些策略得到执行和支持。在提交之前，对等点会发布这些系统链表来确认有足够的背书支持，并且它们来自适当的实体。此外，在此期间将进行版本控制检查，ledger的当前状态将得到同意或一直意见，然后将包含交易的任何块添加到ledger。这个最终检查提供来保护针对两次花费操作和其他可能危及数据完整性的威胁并且允许对非静态变量执行函数。

除了大量背书之外，正确性和版本检查也会发生，在事务流的各个方向上也有正在进行的身份验证。访问控制列表实现是在网络上的分层（从ordering service 到 channel），并且反复签署发布，验证和授权作为一个交易提议通过不同的体系结构组件。总之共识不只是限于约定的一批交易订单;相反，它是一个包罗万象的特性，是在交易从提议到承诺的过程中正在进行的验证的副产品。
